<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>華信職福票 訂購單</title>
  <script src="https://unpkg.com/xlsx-populate/browser/xlsx-populate.min.js"></script>
  <style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 15px; 
    font-size: 14px; 
    background: #f5f6fa; 
  }
  .card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: #fff;
    max-width: 600px;
    margin-left: 0;
    margin-right: auto;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  .field { margin-bottom: 12px; }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 5px;
    font-size: 14px;
    color: #333;
    text-align: left;
  }
  input, select {
    width: 90%;
    max-width: 300px;
    padding: 6px 8px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
    display: block;
    margin: 0 auto;
  }
  button {
    margin: 5px 3px;
    padding: 8px 14px;
    font-size: 14px;
    border: none;
    border-radius: 5px;
    background: #007bff;
    color: #fff;
    cursor: pointer;
  }
  button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h2>華信職福票 多筆訂購單</h2>

  <div id="formArea">
    <div class="card">
      <div class="field">
        <label>姓名</label>
        <select class="name" onchange="autoFill(this)">
          <option value="">請選擇姓名</option>
          <option value="洪子錡">洪子錡</option>
          <option value="許毓倫">許毓倫</option>
        </select>
      </div>
      <div class="field">
        <label>身分證字號 / 護照號碼</label>
        <input type="text" class="id" readonly>
      </div>
      <div class="field">
        <label>手機號碼</label>
        <input type="tel" class="phone" readonly>
      </div>
      <div class="field">
        <label>日期</label>
        <input type="date" class="date">
      </div>
      <div class="field">
        <label>起站</label>
        <select class="from">
          <option value="">選擇起站</option>
          <option value="台北">台北</option>
          <option value="桃園">桃園</option>
          <option value="新竹">新竹</option>
          <option value="台中">台中</option>
          <option value="台南">台南</option>
          <option value="左營">左營</option>
        </select>
      </div>
      <div class="field">
        <label>訖站</label>
        <select class="to">
          <option value="">選擇訖站</option>
          <option value="台北">台北</option>
          <option value="桃園">桃園</option>
          <option value="新竹">新竹</option>
          <option value="台中">台中</option>
          <option value="台南">台南</option>
          <option value="左營">左營</option>
        </select>
      </div>
      <div class="field">
        <label>班次</label>
        <input type="number" class="train" inputmode="numeric" placeholder="班次號碼">
      </div>
      <div class="field">
        <label>時間</label>
        <input type="time" class="time">
      </div>
      <div class="field">
        <button type="button" onclick="deleteCard(this)">刪除</button>
      </div>
    </div>
  </div>

  <button type="button" onclick="addCard()">新增一筆</button>
  <button type="button" onclick="generateExcel()">下載 Excel</button>

  <script>
    // 姓名對應表
    const passengers = {
      "洪子錡": { id: "S124176767", phone: "0988226061" },
      "許毓倫": { id: "F228623447", phone: "0908637656" }
    };

    // 姓名選擇自動帶入
    function autoFill(selectEl) {
      const card = selectEl.closest(".card");
      const selectedName = selectEl.value;
      if (passengers[selectedName]) {
        card.querySelector(".id").value = passengers[selectedName].id;
        card.querySelector(".phone").value = passengers[selectedName].phone;
      } else {
        card.querySelector(".id").value = "";
        card.querySelector(".phone").value = "";
      }
    }

    // 新增一筆卡片
    function addCard() {
      const formArea = document.getElementById("formArea");
      const newCard = formArea.firstElementChild.cloneNode(true);
      newCard.querySelectorAll("input, select").forEach(el => {
        if (!el.readOnly) el.value = "";
      });
      formArea.appendChild(newCard);
    }

    // 刪除卡片
    function deleteCard(btn) {
      const formArea = document.getElementById("formArea");
      if (formArea.children.length > 1) btn.closest(".card").remove();
    }

    async function generateExcel() {
      const response = await fetch("TicketForm.xlsx");
      const arrayBuffer = await response.arrayBuffer();
      const workbook = await XlsxPopulate.fromDataAsync(arrayBuffer);

      const sheet = workbook.sheet("空白訂購單");

      // 從第4列開始填
      const cards = document.querySelectorAll("#formArea .card");
      cards.forEach((card, i) => {
        const r = 4 + i;
        sheet.cell(`A${r}`).value(card.querySelector(".name").value);   // 姓名
        sheet.cell(`B${r}`).value("全票");                             // 固定值
        sheet.cell(`C${r}`).value(card.querySelector(".id").value);     // 證號
        sheet.cell(`D${r}`).value(card.querySelector(".phone").value);  // 手機
        sheet.cell(`E${r}`).value(card.querySelector(".date").value);   // 日期
        sheet.cell(`F${r}`).value(card.querySelector(".from").value);   // 起站
        sheet.cell(`G${r}`).value(card.querySelector(".to").value);     // 訖站
        sheet.cell(`H${r}`).value(card.querySelector(".train").value);  // 班次
        sheet.cell(`I${r}`).value(card.querySelector(".time").value);   // 時間
        sheet.cell(`J${r}`).value("APP取票");                          // 固定值
        sheet.cell(`K${r}`).value("抬頭:禾群企業社/統編:10849911");       // 固定值
      });

      const blob = await workbook.outputAsync();
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "華信職福票.xlsx";
      link.click();
    }
  </script>
</body>
</html>



